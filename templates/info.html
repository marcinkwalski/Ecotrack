{% extends "base.html" %}
{% block content %}

<h1>Informacje ekologiczne â€” Analizy globalne i krajowe</h1>

<style>
    .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }

    .tab-btn {
        padding: 10px 16px;
        border-radius: 6px;
        background: #e6e6e6;
        cursor: pointer;
        font-weight: bold;
        border: none;
    }

    .tab-btn.active {
        background: #2b8a3e;
        color: white;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));
        gap: 22px;
        margin-top: 20px;
    }

    .card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .fact {
        display: flex;
        gap: 12px;
        margin-bottom: 10px;
    }

    .fact-icon {
        font-size: 28px;
    }
</style>

<div class="tabs">
    <button class="tab-btn active" data-tab="globalne">ğŸŒ Globalne</button>
    <button class="tab-btn" data-tab="polska">ğŸ‡µğŸ‡± Polska</button>
    <button class="tab-btn" data-tab="transport">ğŸš— Transport</button>
    <button class="tab-btn" data-tab="energia">âš¡ Energia</button>
    <button class="tab-btn" data-tab="jedzenie">ğŸ¥— Jedzenie</button>
</div>

<!-- ====================================================== -->
<!--                ZAKÅADKA GLOBALNE                      -->
<!-- ====================================================== -->
<div id="globalne" class="tab-content active">
    <h2>Globalny kontekst emisji COâ‚‚</h2>

    <div class="info-grid">

        <!-- Wykres globalny -->
        <section class="card">
            <h3>Emisje COâ‚‚ na Å›wiecie (1850â€“2023)</h3>
            <canvas id="chartGlobal" style="width:100%; height:260px;"></canvas>
            <p><small>Dane: Our World In Data, IPCC AR6</small></p>
        </section>

        <!-- Sektory -->
        <section class="card">
            <h3>UdziaÅ‚ sektorÃ³w w globalnych emisjach</h3>
            <canvas id="chartSectors" style="width:100%; height:260px;"></canvas>
            <p><small>Dane: IPCC AR6 (2023)</small></p>
        </section>

        <!-- Fakty -->
        <section class="card">
            <h3>NajwaÅ¼niejsze fakty globalne</h3>
            <div class="fact">
                <div class="fact-icon">ğŸŒ</div>Emisje globalne w 2023: <b>36,8 Gt COâ‚‚</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸ”¥</div>Wzrost temperatury (1850â€“2023): <b>+1,2Â°C</b>
            </div>
            <div class="fact">
                <div class="fact-icon">âš¡</div>NajwiÄ™kszy udziaÅ‚: energetyka <b>~40%</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸ“ˆ</div>Åšrednie emisje na osobÄ™: <b>4,7 t COâ‚‚</b>
            </div>
        </section>

    </div>
</div>


<!-- ====================================================== -->
<!--                      POLSKA                            -->
<!-- ====================================================== -->
<div id="polska" class="tab-content">
    <h2>Emisje COâ‚‚ w Polsce</h2>

    <div class="info-grid">

        <section class="card">
            <h3>Emisje COâ‚‚ per capita â€“ Polska vs UE</h3>
            <canvas id="chartPolandEU" style="width:100%; height:260px;"></canvas>
            <p><small>Dane: EEA 2023, GUS</small></p>
        </section>

        <section class="card">
            <h3>Miks energetyczny Polski (2023)</h3>
            <canvas id="chartEnergyMix" style="width:100%; height:260px;"></canvas>
        </section>

        <section class="card">
            <h3>Fakty o emisjach w Polsce</h3>
            <div class="fact">
                <div class="fact-icon">ğŸ‡µğŸ‡±</div>Emisje na osobÄ™: <b>8,0 t COâ‚‚</b>
            </div>
            <div class="fact">
                <div class="fact-icon">âš¡</div>UdziaÅ‚ wÄ™gla w energii: <b>64%</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸ­</div>Polska = 8. najwiÄ™kszy emitent COâ‚‚ w UE
            </div>
        </section>

    </div>
</div>


<!-- ====================================================== -->
<!--                      TRANSPORT                         -->
<!-- ====================================================== -->
<div id="transport" class="tab-content">
    <h2>WpÅ‚yw transportu na emisje</h2>

    <div class="info-grid">

        <section class="card">
            <h3>Emisje COâ‚‚ na km â€“ rÃ³Å¼ne Å›rodki transportu</h3>
            <canvas id="chartTransport" style="width:100%; height:260px;"></canvas>
            <p><small>Dane: IEA 2023</small></p>
        </section>

        <section class="card">
            <h3>NajwaÅ¼niejsze fakty o transporcie</h3>
            <div class="fact">
                <div class="fact-icon">âœˆï¸</div>Lot samolotem generuje <b>255 g COâ‚‚/km</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸš—</div>Auto spalinowe: <b>180 g COâ‚‚/km</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸš†</div>PociÄ…g: <b>41 g COâ‚‚/km</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸš²</div>Rower: <b>0 g COâ‚‚/km</b>
            </div>
        </section>

    </div>
</div>


<!-- ====================================================== -->
<!--                        ENERGIA                         -->
<!-- ====================================================== -->
<div id="energia" class="tab-content">
    <h2>Energia i emisje COâ‚‚</h2>

    <div class="info-grid">

        <section class="card">
            <h3>Globalne ÅºrÃ³dÅ‚a energii (2023)</h3>
            <canvas id="chartGlobalEnergy" style="width:100%; height:260px;"></canvas>
            <p><small>Dane: IEA Key Energy Statistics 2023</small></p>
        </section>

        <section class="card">
            <h3>Fakty o energetyce</h3>
            <div class="fact">
                <div class="fact-icon">âš¡</div>Energetyka = <b>~40% globalnych emisji</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸ’¨</div>OZE rosnÄ… najszybciej (+17% r/r)
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸ­</div>WÄ™giel nadal dominuje globalnie: <b>36%</b>
            </div>
        </section>

    </div>
</div>


<!-- ====================================================== -->
<!--                       JEDZENIE                         -->
<!-- ====================================================== -->
<div id="jedzenie" class="tab-content">
    <h2>Jedzenie i Å›lad wÄ™glowy</h2>

    <div class="info-grid">

        <section class="card">
            <h3>Åšlad COâ‚‚ produktÃ³w spoÅ¼ywczych (kg COâ‚‚/kg)</h3>
            <canvas id="chartFood" style="width:100%; height:260px;"></canvas>
            <p><small>Dane: Poore & Nemecek 2018</small></p>
        </section>

        <section class="card">
            <h3>NajwaÅ¼niejsze fakty o Å¼ywnoÅ›ci</h3>
            <div class="fact">
                <div class="fact-icon">ğŸ¥©</div>WoÅ‚owina: <b>27 kg COâ‚‚/kg</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸ–</div>Wieprzowina: <b>12 kg</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸ—</div>DrÃ³b: <b>7 kg</b>
            </div>
            <div class="fact">
                <div class="fact-icon">ğŸ¥¦</div>Warzywa: <b>0,5â€“2 kg</b>
            </div>
        </section>

    </div>
</div>


<!-- ====================================================== -->
<!--                 LOGIKA ZAKÅADEK + WYKRESY              -->
<!-- ====================================================== -->

<script>
    /* ==================== ZAKÅADKI ==================== */
document.querySelectorAll(".tab-btn").forEach(btn=>{
    btn.onclick = ()=>{
        document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");

        document.querySelectorAll(".tab-content").forEach(tc=>tc.classList.remove("active"));
        document.getElementById(btn.dataset.tab).classList.add("active");
        // przerysuj wykresy po otwarciu zakÅ‚adki
        setTimeout(()=>{
        drawGlobal();
        drawSectors();
        drawPolandEU();
        drawEnergyMix();
        drawTransport();
        drawFood();
        drawGlobalEnergy();
        }, 20);
    };
});

/* ==================== WYKRESY ==================== */

/* 1. Global trend */
function drawGlobal(){
    const c=document.getElementById("chartGlobal");
    const x=c.getContext("2d");

    c.width=c.clientWidth;
    c.height=c.clientHeight;

    const years=[1850,1900,1950,1970,1990,2000,2010,2020,2023];
    const vals=[2,3,6,15,22,25,30,34,36.8];

    const ML=50, MR=20, MT=20, MB=30;
    const W=c.width-ML-MR, H=c.height-MT-MB;

    const max=Math.max(...vals)*1.2;

    const xx=i=>ML+(i/(vals.length-1))*W;
    const yy=v=>MT+H-(v/max)*H;

    x.clearRect(0,0,c.width,c.height);
    x.strokeStyle="#ccc";
    for(let i=0;i<5;i++){
        const yy2=MT+(H*(i/4));
        x.beginPath(); x.moveTo(ML,yy2); x.lineTo(ML+W,yy2); x.stroke();
    }

    x.strokeStyle="#2b8a3e"; x.lineWidth=3;
    x.beginPath();
    x.moveTo(xx(0),yy(vals[0]));
    for(let i=1;i<vals.length;i++) x.lineTo(xx(i),yy(vals[i]));
    x.stroke();

    vals.forEach((v,i)=>{
        x.beginPath(); x.arc(xx(i),yy(v),5,0,Math.PI*2); x.fillStyle="#2b8a3e"; x.fill();
        x.fillStyle="#222";
        x.fillText(years[i],xx(i)-10,c.height-5);
    });
}

/* 2. Sektory */
function drawSectors(){
    const c=document.getElementById("chartSectors");
    const x=c.getContext("2d");
    c.width=c.clientWidth; c.height=c.clientHeight;

    const data={"Energia":40,"Transport":20,"PrzemysÅ‚":15,"Rolnictwo":12,"Budynki":6,"Odpady":2};
    const entries=Object.entries(data);
    const max=40;
    const barW=c.width/entries.length-20;

    x.clearRect(0,0,c.width,c.height);
    entries.forEach((e,i)=>{
        const h=(e[1]/max)*(c.height-50);
        x.fillStyle="#2b8a3e";
        x.fillRect(10+i*(barW+15),c.height-30-h,barW,h);
        x.fillStyle="#222";
        x.fillText(e[0],10+i*(barW+15),c.height-10);
    });
}

/* 3. Polska vs UE */
function drawPolandEU(){
    const c=document.getElementById("chartPolandEU");
    const x=c.getContext("2d");
    c.width=c.clientWidth;c.height=c.clientHeight;

    const lab=["USA","Australia","Polska","UE","Åšwiat"];
    const val=[14,16,8,6.4,4.7];
    const max=16;
    const barW=c.width/lab.length-20;

    x.clearRect(0,0,c.width,c.height);
    lab.forEach((l,i)=>{
        const h=(val[i]/max)*(c.height-50);
        x.fillStyle="#2b8a3e";
        x.fillRect(10+i*(barW+15),c.height-30-h,barW,h);
        x.fillStyle="#222";
        x.fillText(l,10+i*(barW+15),c.height-10);
    });
}

/* 4. Miks energetyczny PL */
function drawEnergyMix(){
    const c=document.getElementById("chartEnergyMix");
    const x=c.getContext("2d");
    c.width=c.clientWidth;c.height=c.clientHeight;

    const data={"WÄ™giel":64,"Gaz":17,"OZE":19};
    const max=64;
    const entries=Object.entries(data);
    const barW=c.width/entries.length-30;

    x.clearRect(0,0,c.width,c.height);
    entries.forEach((e,i)=>{
        const h=(e[1]/max)*(c.height-50);
        x.fillStyle="#2b8a3e";
        x.fillRect(15+i*(barW+25),c.height-30-h,barW,h);
        x.fillStyle="#222";
        x.fillText(e[0],15+i*(barW+25),c.height-10);
    });
}

/* 5. Transport */
function drawTransport(){
    const c=document.getElementById("chartTransport");
    const x=c.getContext("2d");
    c.width=c.clientWidth;c.height=c.clientHeight;

    const data={"Samolot":255,"SamochÃ³d":180,"Autobus":105,"PociÄ…g":41,"Rower":0};
    const max=255;
    const entries=Object.entries(data);
    const barW=c.width/entries.length-20;

    x.clearRect(0,0,c.width,c.height);
    entries.forEach((e,i)=>{
        const h=(e[1]/max)*(c.height-50);
        x.fillStyle="#2b8a3e";
        x.fillRect(10+i*(barW+15),c.height-30-h,barW,h);
        x.fillStyle="#222";
        x.fillText(e[0],10+i*(barW+15),c.height-10);
    });
}

/* 6. Å»ywnoÅ›Ä‡ */
function drawFood(){
    const c=document.getElementById("chartFood");
    const x=c.getContext("2d");
    c.width=c.clientWidth;c.height=c.clientHeight;

    const foods={"WoÅ‚owina":27,"Wieprzowina":12,"DrÃ³b":7,"Ryby":5,"Warzywa":2};
    const max=27;
    const entries=Object.entries(foods);
    const barW=c.width/entries.length-20;

    x.clearRect(0,0,c.width,c.height);
    entries.forEach((e,i)=>{
        const h=(e[1]/max)*(c.height-50);
        x.fillStyle="#2b8a3e";
        x.fillRect(10+i*(barW+15),c.height-30-h,barW,h);
        x.fillStyle="#222";
        x.fillText(e[0],10+i*(barW+15),c.height-10);
    });
}
/* 6. Globalne ÅºrÃ³dÅ‚a energii (IEA 2023) */
function drawGlobalEnergy(){
    const c=document.getElementById("chartGlobalEnergy");
    if (!c) return;
    const x=c.getContext("2d");

    c.width = c.clientWidth;
    c.height = c.clientHeight;

    const data = {
        "WÄ™giel": 36,
        "Gaz": 22,
        "Ropa": 28,
        "OZE": 12,
        "Atom": 4
    };

    const entries = Object.entries(data);
    const max = 36; // najwiÄ™ksza wartoÅ›Ä‡
    const barW = c.width / entries.length - 25;

    x.clearRect(0,0,c.width,c.height);

    entries.forEach((e,i)=>{
        const [label,val] = e;
        const h = (val/max) * (c.height - 50);

        x.fillStyle = "#2b8a3e";
        x.fillRect(10 + i*(barW+15), c.height - 30 - h, barW, h);

        x.fillStyle = "#222";
        x.fillText(label, 10 + i*(barW+15), c.height - 10);
    });
}
/* 6. Globalne ÅºrÃ³dÅ‚a energii (IEA 2023) */
function drawGlobalEnergy(){
const c=document.getElementById("chartGlobalEnergy");
if (!c) return;
const x=c.getContext("2d");

c.width = c.clientWidth;
c.height = c.clientHeight;

const data = {
"WÄ™giel": 36,
"Gaz": 22,
"Ropa": 28,
"OZE": 12,
"Atom": 4
};

const entries = Object.entries(data);
const max = 36; // najwiÄ™ksza wartoÅ›Ä‡
const barW = c.width / entries.length - 25;

x.clearRect(0,0,c.width,c.height);

entries.forEach((e,i)=>{
const [label,val] = e;
const h = (val/max) * (c.height - 50);

x.fillStyle = "#2b8a3e";
x.fillRect(10 + i*(barW+15), c.height - 30 - h, barW, h);

x.fillStyle = "#222";
x.fillText(label, 10 + i*(barW+15), c.height - 10);
});
}

/* INIT */
document.addEventListener("DOMContentLoaded", ()=>{
    drawGlobal();
    drawSectors();
    drawPolandEU();
    drawEnergyMix();
    drawTransport();
    drawFood();
    drawGlobalEnergy();

    window.addEventListener("resize", ()=>{
        drawGlobal();
        drawSectors();
        drawPolandEU();
        drawEnergyMix();
        drawTransport();
        drawFood();
        drawGlobalEnergy();
    });
});

</script>

{% endblock %}